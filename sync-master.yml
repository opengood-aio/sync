version: 2.0

ci:
  providers:
    # -----------------------------------------------------------
    # GitHub Actions
    # -----------------------------------------------------------
    - name: GitHub Actions
      template:
        src:
          repo: central-workflows
          path: workflows
        target:
          path: .github/workflows

versions:
  config:
    patterns:
      dev-version: '.*\-SNAPSHOT'
      semantic-version: '(\d+\.)?(\d+\.)?(\*|\d+)'
      version-number: '(0|[1-9]\d*)\.(0|[1-9]\d*)\.?(0|[1-9]\d*)?(?:(-|\.)((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?'
      version-number-ignore:
        - alpha
        - beta
        - rc
        - dev

  exclusions:
    - description: spring-boot-3
      type: Gradle Dependency
      group: org.springframework.boot
      name: spring-boot-starter-parent
      versions:
        - 3.*

  providers:
    # -----------------------------------------------------------
    # Gradle Dependency
    # -----------------------------------------------------------
    - name: Gradle Dependencies
      types:
        - Gradle Dependency
      tools:
        - Gradle
      files:
        - versions.properties
      read:
        - key: group
          pattern: '.*?(\.{2})'
          index: 0
          trim:
            - 'version.'
            - '..'
        - key: name
          pattern: '\.{2}.*?\='
          index: 0
          trim:
            - '..'
            - '='
        - key: version
          pattern: '=\s*(.*)'
          index: 0
          trim:
            - '='
      uris:
        - uri: https://repo.maven.apache.org/maven2/{group}/{name}/maven-metadata.xml
          source: Maven Central
          pattern: '//metadata/versioning/versions/version'
          index: 0
      write:
        - key: version
          pattern: 'version.{group}..{name}={version}'
          index: 0

    - name: Maven Dependencies and Plugins
      enabled: false
      types:
        - Maven Dependency
        - Maven Nexus Dependency
        - Maven Plugin
      tools:
        - Maven
      files:
        - pom.xml
      read:
        - key: group
          pattern: '(?<=groupId\>)(.+)(?=\<)'
          index: 0
          trim:
            - '<groupId>'
            - '</groupId>'
        - key: name
          pattern: '(?<=artifactId\>)(.+)(?=\<)'
          index: 0
          trim:
            - '<artifactId>'
            - '</artifactId>'
        - key: version
          pattern: '(?<=version\>)(.+)(?=\<)'
          index: 0
          trim:
            - '<version>'
            - '</version>'
      uris:
        - uri: https://nexus.domain.com/repository/maven-central/{group}/{name}/maven-metadata.xml
          source: Nexus Proxy Repo
          pattern: '//metadata/versioning/versions/version'
          index: 0
        - uri: https://nexus.domain.com/service/rest/v1/search?repository=hosted&maven.groupId={group}&maven.artifactId={name}&maven.extension=jar&sort=version
          source: Nexus Hosted Repo
          pattern: '$.items'
          index: 1
        - uri: https://nexus.domain.com/service/rest/v1/search?repository=hosted&maven.groupId={group}&maven.artifactId={name}&maven.extension=pom&sort=version
          source: Nexus Hosted Repo
          pattern: '$.items'
          index: 2
      write:
        - key: version
          pattern: '<version>{version}</version>'
          index: 0
